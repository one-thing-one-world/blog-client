kind: pipeline
type: docker
name: default
clone:
  disable: true

steps:
  - name: clone-test
    image: alpine/git
    pull: if-not-exists # 如果在本地缓存中找不到图像，则仅拉取图像
    commands:
      - git config --global http.version HTTP/1.1
      - git clone https://github.com/one-thing-one-world/blog-client.git #自定义克隆地址
      - git version

  - name: install && build
    image: node
    pull: always
    commands:
      # - git config --global http.version HTTP/1.1
      - pwd
      - ls
      - echo password  ${password}
      # - npm install
      # - npm i react-scripts
      # - npm run build
      - ls
      # - pwd

  - name: sshs
    image: appleboy/drone-ssh
    pull: always
    settings:
      host: 101.37.83.146
      username: username
      port: 22
      password: password
      script:
        # - nginx -s reload
        - echo hello nginxss
        - echo
        - ls

  - name: upload
    image: appleboy/drone-scp
    pull: always
    settings:
      debug: true
      source:
        - build/
      host: 101.37.83.146
      username: ${username}
      port: 22
      password: ${password}
      target: /root/blog
      when:
        branch:
          include:
            - master
        event:
          - push
          - merge
      script:
        # - nginx -s reload
        - echo hello upload
        - echo upload

trigger:
  branch:
    include:
      - master
  event:
    include:
      - push
